---
import "@fontsource/gabarito";
import BaseLayout from "./BaseLayout.astro";
import AppProse from "../components/app/Prose.astro";
const { frontmatter } = Astro.props;
import themeConfig from "@util/themeConfig";
import { Icon } from "astro-icon/components";
const siteTitle = themeConfig.general.title;
const title = frontmatter?.title || siteTitle;
const link = frontmatter?.link;
const instagram = frontmatter?.instagram;
const facebook = frontmatter?.facebook;
const youtube = frontmatter?.youtube;
const phone = frontmatter?.phone;
const apple= frontmatter?.apple;
const google= frontmatter?.google;
const description = frontmatter?.description;
const linkText = link?.replace(/^.*/, "");
const instagramText = instagram?.replace(/^.*/, "");
const facebookText = facebook?.replace(/^.*/, "");
const youtubeText = youtube?.replace(/^.*/, "");
const phoneText = phone?.replace(/^.*/, "");
const hasMapLinks = apple || google;
const appleMapsUrl = apple ? apple : '';
const googleMapsUrl = google ? google : '';
---

<BaseLayout>
  <div class="max-w-2xl w-full mx-auto py-20 px-8">
    <div class="mb-10">
      <div class="flex justify-between items-center">
        <h1 class="font-bold text-4xl">{title}</h1>
      </div>
      <p class="text-gray-600 mt-2.5 mb-2.5">{description}</p>

      <div class="relative mt-5 mb-2.5">
        <!-- Left Arrow -->
        <div id="left-arrow" class="hidden absolute -left-6 top-1/2 transform -translate-y-1/2 bg-primary-500 p-2 rounded-full shadow-lg cursor-pointer">
          <Icon name="tabler:arrow-left" color="white" size="15px" title="left" />
        </div>
      
        <!-- Scrollable Content -->
        <div id="scrollable-content" class="overflow-x-auto whitespace-nowrap hide-scrollbar">
          <div class="inline-flex gap-4">
        {
          link && (
            <a class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded" href={link} target="_blank" rel="noopener noreferrer">
              {linkText}
              <Icon name="tabler:link" size="25px" title="website" />Website
            </a>
          )
        }
        {
          instagram && (
            <a class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded" href={instagram} target="_blank" rel="noopener noreferrer">
              {instagramText}
              <Icon name="lineicons:instagram" size="25px" title="instagram" />Instagram
            </a>
          )
        }
        {
          facebook && (
            <a class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded" href={facebook} target="_blank" rel="noopener noreferrer">
              {facebookText}
              <Icon name="tabler:brand-facebook" size="25px" title="facebook" />Facebook
            </a>
          )
        }
        {
          youtube && (
            <a class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded" href={youtube} target="_blank" rel="noopener noreferrer">
              {youtubeText}
              <Icon name="tabler:brand-youtube" size="25px" title="youtube" />YouTube
            </a>
          )
        }
        {
          phone && (
            <a class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded" href={phone}>
              {phoneText}
              <Icon name="tabler:phone" size="25px" title="phone" />Call Now
            </a>
          )
        }
        {
          hasMapLinks && (
            <div id="map-link-container" 
                 data-apple={appleMapsUrl}
                 data-google={googleMapsUrl}
                 class="inline-flex">
              <!-- Initial content will be replaced by JavaScript -->
              <a class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded"
                 href={googleMapsUrl}
                 target="_blank"
                 rel="noopener noreferrer">
                <Icon name="tabler:navigation" size="25px" title="Directions" /> Get Directions
              </a>
            </div>
          )
        }       
      </div></div>
      <div id="right-arrow" class="hidden absolute -right-6 top-1/2 transform -translate-y-1/2 bg-primary-500 p-2 rounded-full shadow-lg cursor-pointer">
        <Icon name="tabler:arrow-right" color="white" size="15px" title="right" />
      </div>
    </div>
    <p class="mt-10" />
    <AppProse>
      <slot />
    </AppProse>
  </div>
</BaseLayout>

<style>
  .hide-scrollbar {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE and Edge */
}

.hide-scrollbar::-webkit-scrollbar {
  display: none; /* Chrome, Safari, and Opera */
}
</style>
<script is:inline>
  document.addEventListener('DOMContentLoaded', function () {
    const scrollableContent = document.getElementById('scrollable-content');
    const leftArrow = document.getElementById('left-arrow');
    const rightArrow = document.getElementById('right-arrow');

    // Initial check to hide arrows if not needed
    function checkScrollState() {
      const canScrollLeft = scrollableContent.scrollLeft > 0;
      const canScrollRight = scrollableContent.scrollLeft + scrollableContent.clientWidth < scrollableContent.scrollWidth;
      
      leftArrow.classList.toggle('hidden', !canScrollLeft);
      rightArrow.classList.toggle('hidden', !canScrollRight);
    }

    // Run the check initially
    checkScrollState();

    scrollableContent.addEventListener('scroll', checkScrollState);

    leftArrow.addEventListener('click', function () {
      scrollableContent.scrollBy({
        left: -200, // Adjust the scroll distance as needed
        behavior: 'smooth'
      });
    });

    rightArrow.addEventListener('click', function () {
      scrollableContent.scrollBy({
        left: 200, // Adjust the scroll distance as needed
        behavior: 'smooth'
      });
    });
  });
</script>
<script is:inline>
    const mapLinkContainer = document.getElementById('map-link-container');
    if (mapLinkContainer) {
      const isAppleDevice = () => /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                              (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

      const appleUrl = mapLinkContainer.dataset.apple;
      const googleUrl = mapLinkContainer.dataset.google;
      
      if (appleUrl || googleUrl) {
        // Navigation icon SVG (same as tabler:navigation)
        const navIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="3 11 22 2 13 21 11 13 3 11"/>
        </svg>`;

        const linkHtml = isAppleDevice() && appleUrl ? `
          <a id="apple-map-link"
             class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded"
             href="#"
             target="_blank"
             rel="noopener noreferrer">
            ${navIcon} Get Directions
          </a>
        ` : googleUrl ? `
          <a id="google-map-link"
             class="inline-flex items-center gap-1 font-medium px-2.5 py-1 border-2 border-black rounded"
             href="${googleUrl}"
             target="_blank"
             rel="noopener noreferrer">
            ${navIcon} Get Directions
          </a>
        ` : '';
        
        mapLinkContainer.innerHTML = linkHtml;

        if (isAppleDevice() && appleUrl) {
          document.getElementById('apple-map-link')?.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = appleUrl.replace('https://', 'maps://');
            setTimeout(() => {
              if (!document.hidden) window.open(appleUrl, '_blank');
            }, 500);
          });
        }
      }
    }
</script>